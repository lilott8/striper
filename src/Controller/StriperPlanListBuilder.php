<?php
/**
 * Created by PhpStorm.
 * User: jason
 * Date: 3/9/17
 * Time: 1:30 PM
 */

namespace Drupal\striper\Controller;

use Drupal\striper;
use Drupal\Core\Url;
use Drupal\Core\Link;
use Drupal\Core\Config\Entity\ConfigEntityListBuilder;
use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Entity\EntityStorageInterface;
use Drupal\Core\Entity\EntityTypeInterface;

class StriperPlanListBuilder extends ConfigEntityListBuilder {

    public function __construct(EntityTypeInterface $entity_type, EntityStorageInterface $storage) {
        parent::__construct($entity_type, $storage);

        $this->config = \Drupal::config('striper.config');

        if($this->config->get('use_key') == 'live') {
            $message = 'You are using your live keys.';
        } else {
            $message = '';
        }

        if(!empty($message)) {
            drupal_set_message($message, 'warning');
        }
    }

    /**
     * Builds the header row for the entity listing.
     *
     * @return array
     *   A render array structure of header strings.
     *
     * @see Drupal\Core\Entity\EntityListController::render()
     */
    public function  buildHeader() {
        $header['plan_name'] = $this->t('Plan Name');
        $header['machine_name'] = $this->t('Machine Name');
        $header['price'] = $this->t('Cost');
        $header['frequency'] = $this->t('Frequency');
        $header['active_plan'] = array('data' => $this->t('Active'), 'field' => 'active', 'sort' => 'asc');
        $header['plan_source'] = $this->t('Source');
        return $header + parent::buildHeader();
    }

    /**
     * Builds a row for an entity in the entity listing.
     *
     * @param EntityInterface $entity
     *   The entity for which to build the row.
     *
     * @return array
     *   A render array of the table row for displaying the entity.
     *
     * @see Drupal\Core\Entity\EntityListController::render()
     */
    public function buildRow(EntityInterface $entity) {
        $row['plan_name'] = $entity->plan_name;
        $row['machine_name'] = $entity->id();
        $row['price'] = $entity->plan_price;
        $row['frequency'] = $entity->plan_frequency;
        $row['active_plan'] = $entity->plan_active ? "enabled" : "disabled";
        $row['plan_source'] = $entity->plan_source;

        return $row + parent::buildRow($entity); // TODO: Change the autogenerated stub
    }

}